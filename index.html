<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Favicon -->
<link rel="icon" type="image/jpg" sizes="32x32" href="logo.jpg">
<title>Peminjaman Ruang Meeting – MAP</title>

  <!-- TailwindCSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />

  <!-- Feather Icons & Chart.js -->
  <script src="https://unpkg.com/feather-icons"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    .sidebar { transition: transform 0.3s ease; }
    @media (min-width: 1024px) {
      #main-header { margin-left: 16rem; }
    }
  </style>
</head>

<body class="bg-gray-100 min-h-screen flex">

 <!-- Tombol Burger (hanya mobile) -->
<button id="btn-open"
        class="lg:hidden fixed top-4 left-4 z-50 p-3 bg-gray-800 text-white rounded-full hover:bg-gray-700 active:scale-95 transition">
  <i data-feather="menu" aria-hidden="true"></i>
  <span class="sr-only">Buka menu</span>
</button>

<!-- Overlay (klik tutup) -->
<div id="overlay" class="fixed inset-0 bg-black/40 hidden z-40 lg:hidden"></div>
<body class="bg-gray-100 min-h-screen flex flex-col">

  <!-- ===== Tombol Burger (mobile) ===== -->
  <button id="btn-open"
          class="lg:hidden fixed top-4 left-4 z-50 p-3 bg-gray-800 text-white
                 rounded-full hover:bg-gray-700 active:scale-95 transition">
    <i data-feather="menu" aria-hidden="true"></i>
    <span class="sr-only">Buka menu</span>
  </button>

  <!-- ===== Overlay Gelap (mobile) ===== -->
  <div id="overlay"
       class="fixed inset-0 bg-black/40 hidden z-40 lg:hidden"></div>

  <!-- ===== SIDEBAR ===== -->
  <aside id="sidebar"
         class="fixed inset-y-0 left-0 w-64 bg-gray-900 text-white shadow-lg
                -translate-x-full lg:translate-x-0 z-50 transition-transform duration-300">
    <div class="flex items-center justify-between p-4 border-b border-gray-700">
      <span class="text-xl font-semibold">MAP Meeting</span>
      <!-- Tombol ✕ (mobile) -->
      <button id="btn-close"
              class="lg:hidden p-2 rounded hover:bg-gray-800 active:scale-95 transition">
        <i data-feather="x" aria-hidden="true"></i>
        <span class="sr-only">Tutup menu</span>
      </button>
    </div>

    <nav class="mt-4 space-y-1">
      <a href="#status"    class="block py-2 px-4 hover:bg-indigo-600">Status</a>
      <a href="#dashboard" class="block py-2 px-4 hover:bg-indigo-600">Dashboard</a>
      <a href="kalender.html"     class="block py-2 px-4 hover:bg-indigo-600">Kalender</a>
      <a href="list_booking.html" class="block py-2 px-4 hover:bg-indigo-600">List Booking</a>
    </nav>
  </aside>

  <!-- ===== WRAPPER KONTEN ===== -->
  <div class="flex-1 flex flex-col lg:ml-64"><!-- header + main + footer di sini --></div>

  <!-- Feather Icons & Script -->
  <script src="https://unpkg.com/feather-icons"></script>
  <script src="sidebar.js"></script>
</body>


  
  <!-- ========= HEADER ========= -->
<header id="main-header"
        class="bg-gradient-to-r from-indigo-700 via-indigo-600 to-indigo-700
               text-white shadow-lg sticky top-0 z-40">

  <!-- Bar logo + judul -->
  <div class="max-w-7xl mx-auto flex items-center justify-between px-4 py-3">
    <!-- Logo kiri -->
    <div class="flex items-center gap-2">
      <img src="logo.jpg" alt="Logo MAP" class="h-9 w-auto rounded shadow" />
      <span class="hidden sm:inline text-lg font-semibold"></span>
    </div>

    <!-- Judul tengah -->
    <h1 class="text-base sm:text-xl md:text-2xl font-extrabold tracking-wide drop-shadow
               text-center flex-1">
      Peminjaman Ruang Meeting
    </h1>

    <!-- Placeholder kanan (agar judul tetap tengah) -->
    <div class="w-12 sm:w-20"></div>
  </div>
</header>
    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto flex flex-col items-center pb-10">

      <!-- Kartu Status -->
      <section id="status" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 w-full max-w-5xl px-3 mt-6">
        <template id="card-template">
          <div class="card-wrapper bg-gradient-to-br from-gray-50 via-white to-gray-100 border-4 border-indigo-300 rounded-2xl shadow-lg flex flex-col items-center text-center p-6">
            <h2 class="room-title text-2xl font-bold mb-4 text-indigo-700">Ruang Meeting</h2>
            <p class="room-status text-3xl font-extrabold mb-6 text-gray-500">Memuat…</p>
            <a class="room-link w-full" target="_blank" rel="noopener">
              <button class="w-full py-3 rounded-full font-semibold bg-indigo-500 hover:bg-indigo-600 text-white transition">Ajukan Peminjaman</button>
            </a>
          </div>
        </template>
        <div id="cards" class="contents"></div>
      </section>

      <!-- Dashboard Chart -->
      <section id="dashboard" class="w-full max-w-3xl mt-16 px-4">
        <div class="bg-gradient-to-br from-indigo-50 via-white to-indigo-100 rounded-3xl shadow-2xl p-8">
          <div class="flex items-center gap-3 mb-6">
            <i data-feather="pie-chart" class="w-8 h-8 text-indigo-600"></i>
            <h3 class="text-3xl font-extrabold text-indigo-400">Status Pemakaian Saat Ini</h3>
          </div>
          <div class="relative w-full flex justify-center">
            <canvas id="usageChart" class="max-w-sm"></canvas>
            <span id="chartLabel" class="absolute inset-0 flex items-center justify-center text-4xl font-black text-gray-700"></span>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="w-full mt-auto">
      <div class="relative">
        <div class="bg-gradient-to-r from-indigo-600 via-indigo-500 to-indigo-700 py-5"></div>
        <div class="absolute inset-0 flex items-center justify-center">
          <a href="#" class="group inline-flex items-center gap-2 text-lg sm:text-xl font-semibold text-white hover:underline">
            <i data-feather="shield" class="w-6 h-6"></i>
            <span> 2025 Mitra Asa Pratama</span>
          </a>
        </div>
      </div>
    </footer>
  </div>

  <!-- SCRIPT -->
  <script>
    feather.replace();

    const apiKey = 'AIzaSyBee80FlAkCPEy4O5lbSgS2ygmetMY0_2w';
    const formLink = 'https://docs.google.com/forms/d/e/1FAIpQLSdMzBvHqAMErUPQnioIor1XRQlB4JfdhK5O-nrLuXg2fE1Hkg/viewform?usp=sharing&ouid=101264464207911273124';
    const calendarIds = {
      arjuna: 'dc49966a239199414780de061d7d0cb226e45b4398f1585fd46950f2a44bcc2d@group.calendar.google.com',
      srikandi: '4b908ab3e0e0eecd09957c9cf6c2d124039222e96112a13ce10a1a322a78b753@group.calendar.google.com',
      gatotkaca: 'a1c8e0d5a5c5c870325fc8bca859002f0c4c2523876bef16176e960312fe68b2@group.calendar.google.com'
    };

    // Sidebar mobile toggle
  // Render ikon Feather
feather.replace();

// Elemen penting
const sidebar = document.getElementById('sidebar');
const overlay = document.getElementById('overlay');
const btnOpen = document.getElementById('btn-open');
const btnClose= document.getElementById('btn-close');

// Fungsi bantu
function openSidebar(){
  sidebar.classList.remove('-translate-x-full');
  overlay.classList.remove('hidden');
}
function closeSidebar(){
  sidebar.classList.add('-translate-x-full');
  overlay.classList.add('hidden');
}

// Event listener
btnOpen .addEventListener('click', openSidebar);
btnClose.addEventListener('click', closeSidebar);
overlay .addEventListener('click', closeSidebar);

// Tutup otomatis saat klik link (hanya mobile)
sidebar.querySelectorAll('a').forEach(link=>{
  link.addEventListener('click', () => {
    if (window.innerWidth < 1024) closeSidebar();
  });
});

    // Build Cards
    const rooms = [
      { key: 'arjuna', name: 'Ruang Meeting Arjuna' },
      { key: 'srikandi', name: 'Ruang Meeting Srikandi' },
      { key: 'gatotkaca', name: 'Ruang Meeting Gatotkaca' }
    ];
    const tpl = document.getElementById('card-template');
    const wrap = document.getElementById('cards');

    rooms.forEach(r => {
      const n = tpl.content.cloneNode(true);
      n.querySelector('.room-title').textContent = r.name;
      n.querySelector('.room-status').id = `status-${r.key}`;
      const link = n.querySelector('.room-link');
      link.href = formLink;
      link.onclick = e => {
        e.preventDefault();
        window.open(formLink, '_blank');
      };
      wrap.appendChild(n);
    });

    // Cek status pemakaian Google Calendar
    async function roomBusy(id) {
      const now = new Date();
      const url = `https://www.googleapis.com/calendar/v3/calendars/${id}/events?key=${apiKey}&singleEvents=true&orderBy=startTime&timeMin=${now.toISOString()}&timeMax=${new Date(now.getTime() + 30000).toISOString()}`;
      const res = await fetch(url).catch(() => null);
      const data = await res?.json?.();
      return data?.items?.length > 0;
    }

    async function updateStatus() {
      const usage = [];
      for (const [room, id] of Object.entries(calendarIds)) {
        const busy = await roomBusy(id);
        const el = document.getElementById(`status-${room}`);
        el.textContent = busy ? 'DIPAKAI' : 'TERSEDIA';
        el.className = busy ? 'text-red-600 font-extrabold text-3xl' : 'text-green-600 font-extrabold text-3xl';
        usage.push(busy ? 1 : 0);
      }
      drawChart(usage);
    }

    function drawChart(arr) {
      const ctx = document.getElementById('usageChart').getContext('2d');
      if (window.usageChartInstance) window.usageChartInstance.destroy();
      window.usageChartInstance = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Terpakai', 'Tersedia'],
          datasets: [{
            data: [arr.filter(x => x).length, arr.filter(x => !x).length],
            backgroundColor: ['#EF4444', '#22C55E']
          }]
        },
        options: {
          plugins: {
            legend: { display: false }
          },
          cutout: '70%'
        }
      });
    }

    updateStatus();
    setInterval(updateStatus, 30000); // Perbarui tiap 1 menit
  </script>
</body>
</html>
