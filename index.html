<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jadwal Peminjaman Ruangan</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css" />
  <style>
    .swiper-slide {
      background: white;
      border-radius: 1rem;
      padding: 1rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800">

  <div class="max-w-4xl mx-auto py-10 px-4">
    <h1 class="text-2xl font-bold mb-6 text-center">ðŸ“… Jadwal Peminjaman Ruangan</h1>
    <div class="swiper mySwiper">
      <div class="swiper-wrapper" id="booking-slides">
        <!-- Slide akan dimuat di sini -->
      </div>
      <div class="swiper-pagination mt-4"></div>
    </div>
  </div>

  <!-- Swiper JS -->
  <script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const supabaseUrl = 'https://mypiqbkyiwcxhznclbcl.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im15cGlxYmt5aXdjeGh6bmNsYmNsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM3Njg5ODQsImV4cCI6MjA2OTM0NDk4NH0.qz7vdrG9IqQXgxFqPw16_P5JUrNlqqN_BsgA66s-yv8'; // sudah kamu isi
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    const labels = ['Kemarin', 'Hari Ini', 'Besok', 'Lusa'];
    const slideContainer = document.getElementById('booking-slides');

    const getFormattedDate = (offset) => {
      const date = new Date();
      date.setDate(date.getDate() + offset);
      return date.toISOString().split('T')[0];
    };

    const loadBookings = async () => {
      for (let i = -1; i <= 2; i++) {
        const tanggal = getFormattedDate(i);
        const label = labels[i + 1];
        const { data, error } = await supabase
          .from('tbl_peminjaman')
          .select('*')
          .eq('tanggal', tanggal)
          .order('jam_pemakaian', { ascending: true });

        let content = '';
        if (data && data.length > 0) {
          data.forEach(item => {
            content += `
              <div class="mb-3">
                <div class="font-semibold">${item.agenda}</div>
                <div class="text-sm text-gray-600">${item.nama} - ${item.ruangan}</div>
                <div class="text-sm text-gray-500">${item.jam_pemakaian} - ${item.jam_selesai}</div>
              </div>
            `;
          });
        } else {
          content = `<p class="text-sm text-gray-500 italic">Tidak ada booking</p>`;
        }

        slideContainer.innerHTML += `
          <div class="swiper-slide">
            <h2 class="text-lg font-bold mb-2">${label} (${tanggal})</h2>
            ${content}
          </div>
        `;
      }

      new Swiper(".mySwiper", {
        slidesPerView: 1.2,
        spaceBetween: 16,
        pagination: {
          el: ".swiper-pagination",
          clickable: true,
        },
        breakpoints: {
          640: { slidesPerView: 2.5 },
          1024: { slidesPerView: 3.5 },
        },
      });
    };

    loadBookings();
  </script>
</body>
</html>
