<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Peminjaman Ruang Meeting â€“ MAP</title>
  <link rel="icon" href="logo.jpg" type="image/jpg">

  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />

  <!-- Swiper.js -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

  <!-- Feather Icons & Tabletop -->
  <script src="https://unpkg.com/feather-icons"></script>
  <script src="https://cdn.jsdelivr.net/npm/tabletop@1.5.1/tabletop.min.js"></script>

  <style>
    .sidebar { transition: transform 0.3s ease; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { scrollbar-width: none; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

<!-- BURGER BUTTON -->
<button id="btn-open" class="lg:hidden fixed top-4 left-4 z-50 p-3 bg-gray-600 text-white rounded-full hover:bg-gray-500">
  <i data-feather="menu"></i>
</button>

<!-- OVERLAY -->
<div id="overlay" class="fixed inset-0 bg-black/40 hidden z-40 lg:hidden"></div>

<!-- Sidebar -->
<aside id="sidebar" class="fixed inset-y-0 left-0 w-64 bg-gray-900 text-white z-40 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out">
  <div class="flex items-center justify-between p-4 border-b border-gray-700">
    <div class="flex items-center gap-2">
      <img src="map-log.png" alt="Logo MAP" class="h-10 w-auto rounded shadow" />
    </div>
    <button id="btn-close" class="lg:hidden p-2 rounded hover:bg-gray-800">
      <i data-feather="x"></i>
    </button>
  </div>
  <nav class="mt-4 space-y-1 px-4">
    <a href="kalender.html" class="block py-2 px-4 rounded hover:bg-indigo-600 transition">ğŸ—“ï¸ Kalendar</a>
    <a href="list_booking.html" class="block py-2 px-4 rounded hover:bg-indigo-600 transition">ğŸ“„ List Booking</a>
    <a href="daftar.html" class="block py-2 px-4 rounded hover:bg-indigo-600 transition">ğŸ“„ Ajukan</a>
  </nav>
</aside>

<div class="flex-1 flex flex-col lg:ml-64">
  <header class="bg-indigo-700 text-white shadow sticky top-0 z-40">
    <div class="max-w-7xl mx-auto flex items-center justify-between px-4 py-3">
      <img src="logo.jpg" class="h-9 w-auto rounded shadow" />
      <h1 class="text-xl font-bold text-center flex-1">Peminjaman Ruang Meeting</h1>
      <div class="w-9"></div>
    </div>
  </header>

  <main class="p-4 space-y-6">
    <!-- SLIDE JADWAL SUPABASE -->
    <div class="swiper mySwiper">
      <div class="swiper-wrapper" id="slide-container">
        <!-- Slides akan dimuat dari JavaScript -->
      </div>
      <div class="swiper-pagination"></div>
    </div>
  </main>

  <div class="fixed bottom-24 right-4 sm:static sm:mb-4 sm:mr-4 sm:flex sm:justify-end z-40">
    <a href="https://docs.google.com/forms/d/e/1FAIpQLSdMzBvHqAMErUPQnioIor1XRQlB4JfdhK5O-nrLuXg2fE1Hkg/viewform?usp=sharing&ouid=101264464207911273124"
       target="_blank" rel="noopener"
       class="inline-flex items-center gap-2 px-4 py-2 sm:px-5 sm:py-2 rounded-full bg-indigo-500 hover:bg-indigo-500 active:scale-95 text-white text-sm sm:text-base font-semibold shadow-lg transition-transform">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 sm:w-5 sm:h-5" fill="none"
           viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
      </svg>
      <span class="hidden sm:inline">Ajukan Peminjaman</span>
      <span class="sm:hidden">Ajukan</span>
    </a>
  </div>

  <footer class="mt-auto">
    <div class="bg-indigo-600 text-white py-4 text-center text-sm">
      <i data-feather="shield" class="inline-block w-4 h-4 mr-1"></i>
      Â© 2025 Mitra Asa Pratama
    </div>
  </footer>
</div>

<!-- SCRIPT UTAMA -->
<script>
  feather.replace();

  document.getElementById("btn-open").onclick = () => {
    document.getElementById("sidebar").classList.remove("-translate-x-full");
    document.getElementById("overlay").classList.remove("hidden");
  };
  document.getElementById("btn-close").onclick = () => {
    document.getElementById("sidebar").classList.add("-translate-x-full");
    document.getElementById("overlay").classList.add("hidden");
  };
</script>

<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

  const supabaseUrl = 'https://mypiqbkyiwcxhznclbcl.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im15cGlxYmt5aXdjeGh6bmNsYmNsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM3Njg5ODQsImV4cCI6MjA2OTM0NDk4NH0.qz7vdrG9IqQXgxFqPw16_P5JUrNlqqN_BsgA66s-yv8';
  const supabase = createClient(supabaseUrl, supabaseKey);

  const today = new Date();
  const tanggalList = [-1, 0, 1, 2].map(offset => {
    const d = new Date(today);
    d.setDate(today.getDate() + offset);
    return d.toISOString().split('T')[0];
  });

  async function fetchData() {
    let { data, error } = await supabase
      .from("peminjaman")
      .select("*")
      .in("tanggal_peminjaman", tanggalList)
      .order("tanggal_peminjaman", { ascending: true });

    if (error) {
      console.error("Gagal ambil data:", error);
      return;
    }

    const wrapper = document.getElementById("slide-container");
    tanggalList.forEach(tgl => {
      const jadwal = data.filter(d => d.tanggal_peminjaman === tgl);
      const tglFormat = new Date(tgl).toLocaleDateString("id-ID", { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
      const html = `
        <div class="swiper-slide bg-white rounded-xl shadow p-4">
          <div class="text-lg font-bold text-indigo-700 mb-2">${tglFormat}</div>
          ${jadwal.length === 0 ? `<p class="text-gray-500">Tidak ada jadwal</p>` : jadwal.map(j => `
            <div class="mb-3">
              <p class="font-semibold">${j.agenda_meeting}</p>
              <p class="text-sm text-gray-600">${j.jam_pemakaian} - ${j.jam_selesai} | ${j.ruangan}</p>
            </div>
          `).join("")}
        </div>`;
      wrapper.innerHTML += html;
    });

    new Swiper('.mySwiper', {
      loop: false,
      slidesPerView: 1,
      spaceBetween: 20,
      pagination: { el: '.swiper-pagination', clickable: true },
    });
  }

  fetchData();
</script>

</body>
</html>
