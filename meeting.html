<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jadwal Meeting</title>

<style>
/* === TIDAK DIUBAH === */
body{
  margin:0;
  padding:20px;
  font-family:'Segoe UI',sans-serif;
  background:
    linear-gradient(0deg,rgba(0,0,0,.55),rgba(0,0,0,.55)),
    url('citylight.png') no-repeat center/cover;
  color:#fff;
}
.logo{display:block;width:130px;margin:0 auto 10px}
h1{text-align:center;margin-bottom:30px}
.top-bar{display:flex;align-items:center;margin-bottom:10px}
.btn{padding:8px 14px;border:none;border-radius:10px;cursor:pointer;font-weight:600}
.btn-login{background:#00d4ff;color:#000}
.btn-logout{background:#ff4d4d;color:#fff}
.container{display:flex;gap:20px;flex-wrap:wrap}
.column{flex:1;background:rgba(255,255,255,.15);padding:16px;border-radius:18px;min-width:260px}
.column h3{text-align:center;margin:6px 0 14px}
.booking{background:rgba(255,255,255,.25);padding:14px;border-radius:14px;margin-bottom:12px;cursor:pointer;transition:.25s}
.booking:hover{transform:scale(1.02);background:rgba(255,255,255,.35)}
.icon-btn{background:transparent;border:none;cursor:pointer;font-size:16px;margin-top:8px}
.icon-delete{color:#ff4d4d}
.icon-edit{color:#00d4ff}
.fab{
  position:fixed;right:24px;bottom:24px;
  width:64px;height:64px;border-radius:50%;
  background:linear-gradient(135deg,#00d4ff,#0090ff);
  color:#fff;display:none;
  align-items:center;justify-content:center;
  font-size:36px;text-decoration:none
}
.modal{
  position:fixed;inset:0;
  background:rgba(0,0,0,.6);
  display:none;align-items:center;justify-content:center;
  z-index:999
}
.modal-box{
  background:#fff;color:#111;
  padding:24px;width:320px;border-radius:18px
}
.close{float:right;cursor:pointer}
input,select{
  width:100%;padding:10px;
  border-radius:8px;border:1px solid #ccc;margin:6px 0
}
#clock{
  margin-right:auto;
  font-weight:600;
  background:rgba(255,255,255,.2);
  padding:6px 12px;
  border-radius:10px;
  backdrop-filter:blur(6px)
}
</style>
</head>

<body>

<div class="top-bar">
  <div id="clock">--</div>
  <button id="loginBtn" class="btn btn-login" onclick="openLoginModal()">@</button>
  <button id="logoutBtn" class="btn btn-logout" onclick="logoutAdmin()" style="display:none">Logout</button>
</div>

<img src="map-log.png" class="logo">
<h1>Jadwal Peminjaman Ruang Meeting<br>PT Mitra Asa Pratama</h1>

<div class="container">
  <div class="column"><h3>Ruang Arjuna</h3><div id="arjuna"></div></div>
  <div class="column"><h3>Ruang Srikandi</h3><div id="srikandi"></div></div>
  <div class="column"><h3>Ruang Gatot Kaca</h3><div id="gatot"></div></div>
</div>

<a href="daftar.html" class="fab" id="addBtn">+</a>

<!-- DETAIL -->
<div class="modal" id="modal" onclick="closeModal()">
  <div class="modal-box" onclick="event.stopPropagation()">
    <span class="close" onclick="closeModal()">‚úñ</span>
    <h3 id="mAgenda"></h3>
    <p>üìç <span id="mRuangan"></span></p>
    <p>üìÖ <span id="mTanggal"></span></p>
    <p>‚è∞ <span id="mJam"></span></p>
    <p>üë§ <span id="mNama"></span></p>
  </div>
</div>

<!-- EDIT -->
<div class="modal" id="editModal" onclick="closeEdit()">
  <div class="modal-box" onclick="event.stopPropagation()">
    <h3>Edit Jadwal</h3>
    <input type="hidden" id="eId">
    <input id="eRuangan">
    <input id="eAgenda">
    <input type="date" id="eTanggal">
    <input type="time" id="eMulai">
    <input type="time" id="eSelesai">
    <input id="eNama">
    <button class="btn btn-login" style="width:100%" onclick="submitEdit()">Simpan</button>
  </div>
</div>

<!-- LOGIN -->
<div class="modal" id="loginModal" onclick="closeLoginModal()">
  <div class="modal-box" onclick="event.stopPropagation()">
    <h3>Login Admin</h3>
    <input type="password" id="pinInput">
    <button class="btn btn-login" style="width:100%" onclick="submitPin()">Login</button>
  </div>
</div>

<script>
/* ================= CONFIG ================= */
const API_URL = "https://script.google.com/macros/s/AKfycbxEiCxQVwxH3DEtTjKWQQ5cPIL4prNSHTkZwPv8MJN4o75Hr0wP5YbNYGEfHQzzZtMr/exec";
const ADMIN_PIN_HASH = "8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92";

let ROLE = localStorage.getItem("role") || "user";
let GLOBAL_DATA=[];

/* ================= LOGIN ================= */
async function sha256(t){
  const b=await crypto.subtle.digest("SHA-256",new TextEncoder().encode(t));
  return [...new Uint8Array(b)].map(x=>x.toString(16).padStart(2,"0")).join("");
}
function submitPin(){
  sha256(pinInput.value).then(h=>{
    if(h===ADMIN_PIN_HASH){
      ROLE="admin";localStorage.setItem("role","admin");
      updateUI();render(GLOBAL_DATA);loginModal.style.display="none";
    }else alert("PIN salah");
  });
}
function logoutAdmin(){
  ROLE="user";localStorage.removeItem("role");
  updateUI();render(GLOBAL_DATA);
}
function updateUI(){
  loginBtn.style.display=ROLE==="admin"?"none":"inline";
  logoutBtn.style.display=ROLE==="admin"?"inline":"none";
  addBtn.style.display=ROLE==="admin"?"flex":"none";
}
updateUI();

/* ================= DATA ================= */
async function loadData(){
  const r=await fetch(API_URL+"?_="+Date.now());
  GLOBAL_DATA=await r.json();
  render(GLOBAL_DATA);
}
function render(data){
  arjuna.innerHTML=srikandi.innerHTML=gatot.innerHTML="";
  data.forEach(d=>{
    const el=document.createElement("div");
    el.className="booking";
    el.onclick=()=>openModal(d);
    el.innerHTML=`
      <b>${d.agenda}</b><br>
      üìÖ ${d.tanggal}<br>
      ‚è∞ ${d.mulai} - ${d.selesai}<br>
      üë§ ${d.nama}
      ${ROLE==="admin"?`
      <br>
      <button class="icon-btn icon-edit" onclick="event.stopPropagation();openEdit(${JSON.stringify(d)})">‚úèÔ∏è Edit</button>
      <button class="icon-btn icon-delete" onclick="event.stopPropagation();hapusData('${d.id}')">üóëÔ∏è Hapus</button>`:""}
    `;
    d.ruangan.toLowerCase().includes("arjuna")&&arjuna.appendChild(el);
    d.ruangan.toLowerCase().includes("srikandi")&&srikandi.appendChild(el);
    d.ruangan.toLowerCase().includes("gatot")&&gatot.appendChild(el);
  });
}

/* ================= EDIT ================= */
function openEdit(d){
  eId.value=d.id;
  eRuangan.value=d.ruangan;
  eAgenda.value=d.agenda;
  eTanggal.value=d.tanggal;
  eMulai.value=d.mulai;
  eSelesai.value=d.selesai;
  eNama.value=d.nama;
  editModal.style.display="flex";
}
function closeEdit(){editModal.style.display="none";}
async function submitEdit(){
  const f=new FormData();
  f.append("action","edit");
  ["id","ruangan","agenda","tanggal","mulai","selesai","nama"]
  .forEach(k=>f.append(k,document.getElementById("e"+k.charAt(0).toUpperCase()+k.slice(1)).value));
  await fetch(API_URL,{method:"POST",body:f});
  closeEdit();loadData();
}

/* ================= DELETE ================= */
async function hapusData(id){
  if(!confirm("Hapus data?"))return;
  const f=new FormData();
  f.append("action","delete");
  f.append("id",id);
  await fetch(API_URL,{method:"POST",body:f});
  loadData();
}

/* ================= CLOCK ================= */
setInterval(()=>clock.textContent=new Date().toLocaleString("id-ID"),1000);
loadData();
</script>
</body>
</html>
